import{a as H,b as z,r as m,j as e,F as w,G as I,H as F}from"./index-CBFzb6A4.js";import{L as R,R as V}from"./Leftbar-DNCBpAyt.js";import{s as K,g as T}from"./signalrService-Bn4cSkDf.js";const U=({onClose:u,packageInfo:h})=>{const x=H(),{status:N}=z(a=>a.payment),{status:y,error:o}=z(a=>a.purchase),[r,C]=m.useState({cardNumber:"",cardHolderName:"",expireMonth:"",expireYear:"",cvc:""}),[i,s]=m.useState({}),[d,f]=m.useState(null),[p,L]=m.useState(null),[t,Y]=m.useState(null);m.useEffect(()=>{p&&(async()=>{await K("payhub");const n=T();p&&n.invoke("RegisterTransaction",p),n.on("Receive",c=>{Y(c),c.status==="success"&&x(w({diamondCount:h.diamondCount,amount:h.amount}))})})()},[p,x,h]);const A=()=>{var E;const a={},n=new Date,c=n.getMonth()+1,v=n.getFullYear(),M=l=>{if(!/^\d+$/.test(l))return!1;let j=0,D=!1;for(let k=l.length-1;k>=0;k--){let b=parseInt(l.charAt(k),10);D&&(b*=2,b>9&&(b-=9)),j+=b,D=!D}return j%10===0};if(r.cardNumber?/^\d{16}$/.test(r.cardNumber)?M(r.cardNumber)||(a.cardNumber="Geçersiz kart numarası."):a.cardNumber="Kart numarası 16 haneli olmalıdır.":a.cardNumber="Kart numarası zorunludur.",!((E=r.cardHolderName)!=null&&E.trim()))a.cardHolderName="Kart üzerindeki isim zorunludur.";else{const l=r.cardHolderName.trim();l.length<5||l.length>50?a.cardHolderName="İsim 5-50 karakter arasında olmalıdır.":/^[a-zA-ZğüşöçıİĞÜŞÖÇ\s]+$/.test(l)||(a.cardHolderName="İsim sadece harf ve boşluk içermelidir.")}if(r.expireMonth?/^(0[1-9]|1[0-2])$/.test(r.expireMonth)||(a.expireMonth="Geçerli bir ay giriniz (01-12)."):a.expireMonth="Son kullanma ayı zorunludur.",!r.expireYear)a.expireYear="Son kullanma yılı zorunludur.";else if(!/^\d{4}$/.test(r.expireYear))a.expireYear="Geçerli bir yıl giriniz (4 haneli).";else{const l=parseInt(r.expireYear),j=parseInt(r.expireMonth);l<v?a.expireYear="Son kullanma yılı geçmiş olamaz.":l===v&&j<c?a.expireMonth="Kartın son kullanma tarihi geçmiş.":l>v+20&&(a.expireYear="Yıl çok ileri bir tarih olamaz.")}return r.cvc?/^\d{3,4}$/.test(r.cvc)||(a.cvc="CVC 3 veya 4 haneli sayı olmalıdır."):a.cvc="CVC numarası zorunludur.",s(a),Object.keys(a).length===0},g=a=>{const{name:n,value:c}=a.target,v=["cardNumber","expireMonth","expireYear","cvc"].includes(n)?c.replace(/\D/g,""):c;C(M=>({...M,[n]:v}))},$=async a=>{if(a.preventDefault(),Y(null),!A())return;const n=await x(I({...r}));if(I.fulfilled.match(n)){if(n.payload.errorMessage){Y({status:"error",message:n.payload.errorMessage});return}const c=n.payload.content,S=btoa(unescape(encodeURIComponent(c)));f(`data:text/html;base64,${S}`),L(n.payload.conversationId)}};m.useEffect(()=>{((t==null?void 0:t.status)==="failure"||(t==null?void 0:t.status)==="error")&&f(null)},[t]);const P=()=>{if(!t)return null;switch(t.status){case"success":return e.jsx("div",{className:"diamond-success-message",children:"✅ Ödeme başarılı. Elmaslar eklendi!"});case"failure":return e.jsx("div",{className:"diamond-status-message error",children:"❌ 3D Ödeme başarısız. Lütfen tekrar deneyin."});case"error":return e.jsx("div",{className:"diamond-status-message error",children:t.message});default:return null}};return e.jsx("div",{className:"diamond-modal-overlay",children:e.jsxs("div",{className:"diamond-modal",children:[e.jsx("button",{className:"diamond-close-button",onClick:u,children:"×"}),e.jsxs("h2",{children:[h.name," Satın Al"]}),!d&&e.jsxs("form",{className:"diamond-payment-form",onSubmit:$,noValidate:!0,children:[e.jsx("input",{name:"cardNumber",placeholder:"Kart Numarası (16 haneli)",value:r.cardNumber,onChange:g,maxLength:16,pattern:"\\d*",onInput:a=>{a.target.value=a.target.value.replace(/[^0-9]/g,"").slice(0,16)},required:!0}),i.cardNumber&&e.jsx("div",{className:"valid-message",children:i.cardNumber}),e.jsx("input",{name:"cardHolderName",placeholder:"Kart Üzerindeki İsim",value:r.cardHolderName,onChange:g,maxLength:50,onInput:a=>{a.target.value=a.target.value.replace(/[^a-zA-ZğüşöçıİĞÜŞÖÇ\s]/g,"")},required:!0}),i.cardHolderName&&e.jsx("div",{className:"valid-message",children:i.cardHolderName}),e.jsxs("div",{className:"diamond-card-details",children:[e.jsxs("div",{className:"input-group",children:[e.jsx("input",{name:"expireMonth",placeholder:"Ay (MM)",value:r.expireMonth,onChange:g,maxLength:2,pattern:"\\d*",onInput:a=>{a.target.value=a.target.value.replace(/[^0-9]/g,"").slice(0,2)},required:!0}),i.expireMonth&&e.jsx("div",{className:"valid-message",children:i.expireMonth})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{name:"expireYear",placeholder:"Yıl (YYYY)",value:r.expireYear,onChange:g,maxLength:4,pattern:"\\d*",onInput:a=>{a.target.value=a.target.value.replace(/[^0-9]/g,"").slice(0,4)},required:!0}),i.expireYear&&e.jsx("div",{className:"valid-message",children:i.expireYear})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{name:"cvc",placeholder:"CVV",value:r.cvc,onChange:g,maxLength:4,pattern:"\\d*",onInput:a=>{a.target.value=a.target.value.replace(/[^0-9]/g,"").slice(0,4)},required:!0}),i.cvc&&e.jsx("div",{className:"valid-message",children:i.cvc})]})]}),P(),e.jsx("button",{type:"submit",className:"diamond-submit-button",disabled:N==="loading"||y==="loading",children:N==="loading"?"Ödeme Başlatılıyor...":"Satın Al"})]}),d&&e.jsxs("div",{className:"diamond-iframe-wrapper",children:[(t==null?void 0:t.status)!=="success"&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"iframe-title",children:"3D Secure Doğrulama"}),e.jsx("iframe",{title:"3D Secure",src:d,className:"diamond-payment-iframe"})]}),P()]}),o&&e.jsx("div",{className:"diamond-status-message error",style:{marginTop:"10px"},children:o})]})})},q=()=>{const[u,h]=m.useState(null),x=H(),{items:N,diamondCount:y,diamondUserPackStatus:o,diamondUserPackError:r}=z(s=>s.diamondPackItem);m.useEffect(()=>{x(F())},[x]);const C=s=>{const d=["blue","green","red","purple","gold"];return d[s%d.length]},i=s=>{const d=Math.floor(s.diamondAmount*(s.bonusPercentage/100));return s.diamondAmount+d};return e.jsxs("div",{className:"diamond-section-container",children:[e.jsx("h2",{className:"diamond-title",children:"Elmas Paketleri"}),e.jsx("p",{className:"diamond-subtitle",children:"İhtiyacına uygun elmas paketini seç ve hemen satın al!"}),e.jsxs("div",{className:"diamond-user-info",children:[o==="loading"&&e.jsx("p",{children:"Yükleniyor..."}),o==="succeeded"&&e.jsxs("p",{children:["💎 Mevcut Elmas: ",e.jsx("strong",{children:y})]}),o==="failed"&&e.jsxs("p",{children:["Elmas bilgisi alınamadı: ",r]})]}),o==="loading"&&e.jsx("div",{className:"diamond-loading",children:e.jsx("p",{children:"Paketler yükleniyor..."})}),o==="failed"&&e.jsx("div",{className:"diamond-error",children:e.jsx("p",{children:"Paketler yüklenirken hata oluştu"})}),o==="succeeded"&&e.jsx("div",{className:"diamond-package-wrapper",children:N.map((s,d)=>{const f=i(s),p=C(d);return e.jsxs("div",{className:`diamond-card ${p}`,children:[e.jsx("div",{className:"diamond-ribbon"}),e.jsxs("div",{className:"diamond-card-content",children:[s.imageUrl?e.jsx("img",{src:`/assets/${s.imageUrl}`,alt:s.name,className:"diamond-img"}):e.jsx("div",{className:"diamond-img-placeholder",children:"💎"}),e.jsx("h4",{className:"diamond-name",children:s.name}),e.jsxs("p",{className:"diamond-desc",children:[s.diamondAmount," Elmas + %",s.bonusPercentage," Bonus"]}),e.jsxs("div",{className:"diamond-price",children:["₺",s.priceInTL]}),e.jsx("button",{className:"diamond-button",onClick:()=>h({...s,totalDiamonds:f,color:p}),children:"Satın Al"})]})]},s.id)})}),u&&e.jsx(U,{packageInfo:{...u,amount:u.priceInTL,diamondCount:u.totalDiamonds,price:`₺${u.priceInTL}`},onClose:()=>h(null)})]})},O=()=>e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"row",children:[e.jsx(R,{}),e.jsx("div",{className:"col-12 col-md-6 ",children:e.jsx(q,{})}),e.jsx(V,{})]})});export{O as default};
