import{j as e,i as X,r as n,a as B,b as U,s as z,d as ee,u as te,e as se,t as ne,g as ae,h as re,k as ie,l as oe}from"./index-CBFzb6A4.js";import{F as ce,a as le}from"./index-CiReyqcp.js";import{s as de,g as ue}from"./signalrService-Bn4cSkDf.js";function he({question:t,selectedAnswer:d,result:a,onSelect:u}){if(!t)return e.jsx("div",{className:"card col-9 question-card p-4",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"300px"},children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})});const o=[{key:1,text:t.optionA},{key:2,text:t.optionB},{key:3,text:t.optionC},{key:4,text:t.optionD},{key:5,text:t.optionE}],h=i=>{var m,x;const c=(x=(m=t.images)==null?void 0:m.find(S=>S.type===i))==null?void 0:x.imageUrl;return c?`${X}${c}`:null},w=h(0);return e.jsxs("div",{className:"card col-9 question-card p-4",children:[w&&e.jsx("div",{className:"question-img",children:e.jsx("img",{src:w,alt:"Soru görseli",className:""})}),e.jsx("h4",{className:"question-text",children:t.text}),e.jsx("div",{className:"options-container w-100 mt-3",children:o.map(i=>{const c=h(i.key);return e.jsxs("button",{className:`btn btn-option text-start ${d===i.key?a==="correct"&&i.key===t.answer?"correct":a==="wrong"&&d===i.key?"wrong":"selected":a==="wrong"&&i.key===t.answer?"correct":""}`,onClick:()=>u(i.key),disabled:a!==null,children:[c&&e.jsx("img",{src:c,alt:"Seçenek görseli",className:"option-image"}),i.text]},i.key)})})]})}const P=["Cevap arkada, tıkla öğren!","Yanıt için çevir!","Bunu biliyor musun?","Arkaya bak ve kontrol et.","Sence doğru cevap ne?"];function xe({flipped:t,onFlip:d,flashCard:a,loading:u,onStarClick:o}){const[h,w]=n.useState(""),[i,c]=n.useState(!1);n.useEffect(()=>{const x=Math.floor(Math.random()*P.length);w(P[x])},[]),n.useEffect(()=>{c((a==null?void 0:a.isStarred)||!1)},[a]);const m=x=>{x.stopPropagation(),c(!i),o(a.flashCardID)};return e.jsxs("div",{className:`card col-3 question-card2 p-4 ${t?"flip":""}`,onClick:d,style:{position:"relative"},children:[e.jsx("div",{className:"card-front",children:e.jsx("h4",{className:"question-text",children:!u&&h})}),e.jsxs("div",{className:"card-back",children:[e.jsx("h4",{className:"question-text",children:!u&&(a==null?void 0:a.back)}),e.jsx(ce,{onClick:m,size:24,color:i?"gold":"gray",style:{position:"absolute",top:10,right:10,cursor:"pointer",zIndex:10}})]})]})}function me({onNext:t,onPrevious:d,onFinish:a,onShowAnswer:u,isLast:o}){return e.jsxs("div",{className:"col-12 next-buton-train-container",children:[e.jsx("button",{className:"next-buton-train",onClick:d,children:"Geri"}),e.jsx("button",{className:"next-buton-train",onClick:u,children:"Cevap"}),o?e.jsx("button",{className:"next-buton-train finish",onClick:a,children:"Bitir"}):e.jsx("button",{className:"next-buton-train",onClick:t,children:"İleri"})]})}function pe({correct:t,incorrect:d,unanswered:a,onClose:u,onFinish:o}){return e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("div",{className:"modal-header",children:e.jsx("h4",{children:"Test Sonuçları"})}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{children:["Doğru Cevaplar: ",t]}),e.jsxs("p",{children:["Yanlış Cevaplar: ",d]}),e.jsxs("p",{children:["Boş Sorular: ",a]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"next-buton-train",onClick:o,children:"Testi Bitir"}),e.jsx("button",{className:"next-buton-train",onClick:u,children:"İncele"})]})]})})}const je=({question:t,onClose:d})=>{const[a,u]=n.useState(""),[o,h]=n.useState(""),[w,i]=n.useState([]),c=n.useRef(null),m=B(),{status:x}=U(s=>s.signalr),[S,T]=n.useState(""),[M,E]=n.useState(!0),F=s=>s?s.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/^\s*[-•]\s+(.*)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>)/gs,"<ul>$1</ul>").replace(/\n{2,}/g,"<br/><br/>").replace(/\n/g,"<br/>"):"";n.useEffect(()=>{(async()=>{await de("ai-hub");const j=ue();if(!j)return;let A=0;for(;!j.connectionId&&A<10;)await new Promise(v=>setTimeout(v,300)),A++;u(j.connectionId||""),i(v=>[...v,{text:t,sender:"user"}]),j.on("ReceiveMessage",v=>{i(k=>{const N=k[k.length-1];if(N&&N.sender==="ai"){const p=[...k];return p[p.length-1]={...N,text:N.text+v},p}else return[...k,{text:v,sender:"ai"}]}),b()})})()},[]),n.useEffect(()=>{t&&a&&m(z({prompt:t,connectionId:a})).unwrap().then(s=>{s!=null&&s.data&&(T(s.data),E(!1))}).catch(s=>{console.error("Mesaj gönderilirken hata oluştu:",s)})},[a,t]);const b=()=>{c.current&&(c.current.scrollTop=c.current.scrollHeight)},$=s=>{s&&s.preventDefault(),o.trim()&&(i(j=>[...j,{text:o,sender:"user"}]),m(z({prompt:o,connectionId:a})),h(""))};return e.jsx("div",{className:"ai-modal-overlay",onClick:d,children:e.jsxs("div",{className:"ai-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"ai-close-icon",onClick:d,children:"×"}),S&&!M?e.jsxs("div",{className:"ai-upgrade-modal",children:[e.jsx("h3",{children:"Uyarı"}),e.jsx("p",{children:S}),e.jsx("button",{onClick:d,style:{padding:"0.5rem 1rem",backgroundColor:"#ff5252",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",fontSize:"1rem",marginTop:"1rem"},children:"Tamam"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Yapay Zeka Yardımcısı"}),e.jsx("div",{className:"ai-chat-box",ref:c,children:w.map((s,j)=>e.jsx("div",{className:`ai-message ${s.sender}`,children:s.sender==="user"?e.jsx("span",{children:s.text}):e.jsx("span",{dangerouslySetInnerHTML:{__html:F(s.text)}})},j))}),x==="loading"&&e.jsxs("div",{className:"ai-typing-indicator",children:[e.jsx("span",{}),e.jsx("span",{}),e.jsx("span",{})]}),e.jsxs("form",{className:"ai-form",onSubmit:$,children:[e.jsx("input",{type:"text",value:o,onChange:s=>h(s.target.value),placeholder:"Mesajınızı yazın..."}),e.jsx("button",{type:"submit",children:"Gönder"})]})]})]})})};function ve(){const[t,d]=n.useState(0),[a,u]=n.useState(null),[o,h]=n.useState(null),[w,i]=n.useState(!1),[c,m]=n.useState(0),[x,S]=n.useState(0),[T,M]=n.useState(0),[E,F]=n.useState(!1),[b,$]=n.useState({}),[s,j]=n.useState(null),[A,v]=n.useState(!1),{testId:k}=ee(),N=te(),p=B(),{questionWithFlashCardStatus:R,questionWithFlashCardData:g,questionWithFlashCardError:q}=U(r=>r.test),L=(g==null?void 0:g.starredFlashCardIds)||[],y=(g==null?void 0:g.questions)||[],O=g?{testID:g.testID,title:g.title,topicID:g.topicID}:null;n.useEffect(()=>{j(Date.now()),p(se(k))},[p,k]);const W=r=>{p(ne({flashCardID:r}))},l=y[t],C=(l==null?void 0:l.flashCard)||null,Y=C?{...C,isStarred:L.includes(C.flashCardID)}:null,G=r=>{if(o!==null)return;const I=l.questionID;u(r),$(f=>({...f,[I]:r})),r===l.answer?(h("correct"),m(f=>f+1)):(h("wrong"),S(f=>f+1),p(ae()))};n.useEffect(()=>{const r=l==null?void 0:l.questionID;r&&b[r]?(u(b[r]),h(b[r]===l.answer?"correct":"wrong")):(u(null),h(null)),i(!1)},[t,l,b]);const H=()=>{o===null&&l&&(u(l.answer),h("correct"),m(r=>r+1))},Q=()=>{t<y.length-1&&d(r=>r+1)},Z=()=>{t>0&&d(r=>r-1)},_=()=>{let r=0,I=0;y.forEach(f=>{const D=b[f.questionID];D!==void 0&&(D===f.answer?r++:I++)}),m(r),S(I),M(y.length-Object.keys(b).length),F(!0)},J=()=>{const I=Date.now()-s,f=Math.ceil(I/(1e3*60));p(re({wrongAnswerCount:x})),p(ie({wrongAnswerCount:x}));const D=new Date,V=new Date(D.getTime()-D.getTimezoneOffset()*6e4).toISOString();p(oe({completedAt:V,performances:[{topicId:O.topicID,correctCount:c,wrongCount:x,durationInMinutes:f}]})),F(!1),N(-1)},K=()=>v(!0);return R==="loading"?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"100vh"},children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):R==="failed"?e.jsxs("div",{className:"error-container",children:[e.jsxs("p",{children:["Hata: ",q]}),e.jsx("button",{onClick:()=>window.location.reload(),children:"Tekrar Dene"})]}):R==="succeeded"&&y.length===0?e.jsxs("div",{className:"no-questions-container",children:[e.jsx("p",{children:"Bu test için soru bulunamadı."}),e.jsx("button",{onClick:()=>N(-1),children:"Geri Dön"})]}):e.jsxs("div",{className:"train-container",children:[e.jsxs("div",{className:"back-button-train",onClick:()=>N(-1),children:[e.jsx(le,{size:50})," Geri"]}),e.jsx("h4",{className:"train-title",children:"Oku ve yanıtla"}),e.jsxs("div",{className:"container question-container row",children:[e.jsx("div",{className:"progress-bar-train",children:e.jsx("div",{className:"progress-bar-fill-train",style:{width:`${(t+1)/y.length*100}%`}})}),e.jsx(he,{question:l,selectedAnswer:a,result:o,onSelect:G}),e.jsx(xe,{flipped:w,onFlip:()=>i(!w),flashCard:Y,onStarClick:()=>W(C==null?void 0:C.flashCardID)}),e.jsx(me,{onNext:Q,onPrevious:Z,onFinish:_,onShowAnswer:H,isLast:t===y.length-1}),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx("button",{className:"next-buton-train",onClick:K,children:"Yapay Zeka"})})]}),A&&e.jsx(je,{question:(l==null?void 0:l.text)||"Soru bulunamadı.",onClose:()=>v(!1)}),E&&e.jsx(pe,{correct:c,incorrect:x,unanswered:T,onClose:()=>F(!1),onFinish:J})]})}export{ve as default};
